
'use strict'
const { EventEmitter } = require('events')
const dgram = require('dgram')
const server = dgram.createSocket('udp4')

class UDP extends EventEmitter {
  constructor (config) {
    super()
    this.config = config
    this.config.UDP = new URL(config.UDP || 'udp://0.0.0.0:9001')
  }

  start () {
    const { UDP } = this.config

    server.on('listening', () => {
      this.emit('media-started')
    })

    server.on('message', (message, remote) => {
      this.emit('media-data', message)
    })
    server.bind(UDP.port, UDP.hostname)
  }
}

module.exports = UDP
